# linux基础使用

---

[toc]

## 终端

查看终端的命令 tty

* 设备终端
* 虚拟终端 ctrl+alt+f[1-6] /dev/tty#
* 图形终端 /dev/tty7
* 串行终端
* 伪终端(通过ssh远程连接的终端) /dev/pts/#

查看ip地址 ip addr

### 交互式接口

* GUI(桌面)
* CLI (命令行)
  1. powershell(windows)
  2. sh
  3. bash(liunx,mac默认)
  4. zsh
  5. csh
  6. tcsh

### bash

bash是linux系统的用户界面，提供了用户与系统的交互，它接受用户的输入，让它送给操作系统执行

* 查看当前使用的shell echo $SHELL
* 查看当前系统可以使用的shell cat /etc/shells
* 切换shell chsh -s shell路径

### bash快捷键

1. ctrl+l 清屏 相当与执行clear命令
2. ctrl+o 执行当前的命令，并显示该命令
3. ctrl+s 锁定，不可输入
4. ctrl+q 解锁
5. ctrl+c 终止命令
6. ctrl+z 挂起命令(使用fg恢复到前台，bg恢复到后台继续执行)
7. ctrl+a 光标移动到行首，相当`home`
8. ctrl+e 光标移动到行尾，相当`end`
9. ctrl+xx 光标在开头与当前位置跳转
10. ctrl+k 删除光标到最后的内容
11. ctrl+u 删除光标到开始的内容
12. ctrl+r 查找输入过的命令
13. alt+r 删除整行

### 命令提示符

~~~shell
用户@计算机名:当前路径#
管理员用户为 # 
普通用户为 $
~~~

## 命令

* 内部命令：是shell自带的命令
  * 只有内部命令可以使用 help 命令 来查看帮助
* 外部命令：第三方提供的命令

查看命令类型 type 命令

### 别名

* 查看当前所有别名 alias
* 设置别名 alias 别名="命令"
  * 设置别名只对当前终端有效
* 取消设置的别名 unalias 别名

如要设置永久别名 echo 'alias 别名="命令"' >> /etc/bashrc(对所用户有效)|~/.bashrc(对当前用户有效)

要执行命令本书：

1. \command
2. "command"
3. 'command'
4. path

### 命令格式

command [options...][args...]
命令 [选项] [命令作用体]

args：命令的作用体，一般是目录或文件，用户名
options：开启或关系命令的某些功能

* 长选项 --help --color
* 段选项 -i -l

1. 短选项可以合并
2. 命令、选项、作用体之间用空格隔开
3. `crtl`+`c`可以结束命令的执行
4. 同一行执行多个命令使用`;`分隔命令
5. 一个命令使用多行输入用`\`连接

### 命令帮助

内部命令：

1. help command
2. man command

外部命令：

1. command -h
2. command --help
3. man cmmand
4. 官方文档

~~~shell
[]可选项
<>表示比变化的数据
...表示列表
a|b|c 或者 -abc 表示 -a -b -c
{} 表示分组
~~~

### tab键

命令补全：

1. 内部命令直接补全
2. 外部命令：根据环境变量定义的路径，从前往后依次查找，自动匹配第一个查找的内容
3. 如果用户给的内容只有一个匹配则补全
4. 如果有多个匹配，则需要按`tab`键显示提示

### 引号

对于变量`""`会显示对象值
`''`则会显示变量本身

* 变量的使用$变量名

对于命令``会显示命令的结果
引号则会显示命令本身

### 命令历史

1. 可以通过上下来查找之前执行的；命令
2. 之前执行的命令在～/.bash_history文件中,或者执行history来查看
3. 执行上一条命令可以使用上箭头|!!|!-1来实行
4. !#指定第#条命令
5. !string 用来匹配最近因此匹配到的命令
6. !-#指定倒数第#条命令
7. ctrl+r 搜索命令
8. ctrl+g 取消搜索

### 命令展开

~~~shell
{1..20..2}
1到20步长2
~~~

### echo 回显

~~~shell
echo -e '456\n123'  #翻译字符中的转义字符
~~~

### 管道符

~~~shell

命令1|命令2|命令3 #将命令1的结果作为命令2的输入，再将命令2的输出给命令3作为输入
~~~

* 默认情况下管道之传送标准输出
* 也可以把错误输出传递 |&
* 一些命令是不接受管道传递

### 查看用户登陆

1. 查看当前登陆用户 whoami
2. 显示所有用户执行的命令 w

### 时间

1. 查看当前时间 date
2. 修改时间 date 时间
3. 同步ntp时间源 ntpdate ntp时间源地址

|命令拓展|效果|
|--|--|
|date +%a|显示星期缩写|
|date +%A|显示星期全写|
|date +%F|显示年月日|
|date +%H|显示小时(24小时制)|
|date +%I|显示小时(12小时制)|
|date +%m|显示月份(数字)|
|date +%M|显示分钟|
|date +%h|显示月份(字符)|
|date +%c|显示本地时间|
|date +%T|显示时分秒|
|date +%y|显示年(后两位)|
|date +%Y|显示年|
|date +%Y/+%m/+%d|显示年月日|
|date +%W|显示本周为今年第几周|

1. 显示时区 timedatectl
2. 修改时区 timedatectl set-timezone 时区

### 日历

显示日历 cal

|命令|效果|
|--|--|
|cal|显示本月日历|
|cal -y|显示本年日历|
|cal 年|显示当年日日|

### 关机/重启

|关机命令|效果|
|--|--|
|shutdown|一分钟后关机|
|shutdown -c|取消关机|
|shutdown +#|#分钟之后关机|
|shutdown hh：mm|指定时间关机|
|poweroff|立刻关机|
|halt|关机，当保持通电|
|init 0|立刻关机|
|reboot -p|关机|

|重启命令|效果|
|--|--|
|reboot|重启|
|shutdown -r|重启|
|init 6|重启|

## 文件

### 文件目录结构

1. 文件和目录被组织在一颗倒置的树状结构
2. 系统文件从`/`根文件开始
3. 文件严格区分大小写
4. 隐藏文件以`.`开头
5. 路径以`/`为分隔符
6. 文件名长度最大为255
7. 路径最大4095字符(包含文件名称)
8. 除了`\`与NULL不可使用和，其他字符都可以用来命名文件与文件夹

|文件名字颜色|代表|
|--|--|
|蓝色|文件夹|
|绿色|可执行文件|
|红色|压缩文件|
|蓝绿色|连接文件|
|灰色|其他文件|
|白色|文件|

### 文件系统结构

* /boot 引导文件的存放位置，内核文件、引导加载器都在此目录
* /bin 所有的用户都可以使用的命令
* /sbin 管理类的命令
* /lib 启动时程序使用的基本库文件 .so结尾
* /lib64 专门存放X86_64系统上得辅助库文件
* /etc 存放配置文件
* /home/USERNAME 普通用户的家目录
* /root 管理员的家目录
* /media 便携式移动设备的挂载点
* /mnt 临时文件的挂载点
* /dev 设备文件和特殊文件的存放位置
* /opt 第三方的应用的安装位置
* /tmp 临时文件的存放位置
* /usr 存放安装程序
* /var 存放经常变化的文件，比如日志
* /proc 存放内核启动和进程相关的虚拟文件
* /sys 输出当前系统上的硬件相关的文件
* /srv 系统上允许的服务用到的数据

* 二进制文件
  * /bin
  * /sbin
  * /usr/bin
  * /usr/sbin
  * /usr/local/bin
  * /usr/local/sbin
* 库文件
  * /lib
  * /lib64
  * /usr/lib
  * /usr/lib64
  * /usr/local/lib
  * /usr/local/lib64
* 配置文件
  * /etc
  * /etc/name
  * /usr/local/etc
* 帮助文件
  * /usr/share/man
  * /usr/share/doc
  * /usr/local/share/man
   /usr/local/share/doc

### 绝对路径与相对路径

绝对路径：

* 以根开始
* 完整的文件的存放位置
* 可以读取到任何一个文件或文件夹

相对路径：

* 不以根路径开始
* 相对当前位置来决定
* 可以简短的表示一个文件或者文件夹
* `.`当前目录
* `..`父级目录

### 文件命令

|命令|说明|
|--|--|
|basename 路径|文件名称或文件架名称|
|dirname 路径|路径名称(去除最后的文件或者文件夹名称)|
|cd 路径|切换目录|
|cd|切换到家目录|
|cd -|返回上一次的目录|
|pwd|显示当前的工作的目录|
|ls|显示当前目录下的文件(不够详细)|
|ls -a|显示当前目录下的所有的文件|
|ls -l|以长格式显示文件列表|
|ls -R|递归显示目录|
|ls -1|文件一行一个显示|
|ls -r|倒序显示|
|ls -lh|与-l类似但是文件大小带上单位|
|ls -S|按照文件大小排序|

#### 长格式显示例子

~~~shell

lrwxrwxrwx#文件权限(第一位是文件格式)   1#硬盘引用次数 root#所属用户 root#所属用户组          7#大小 9月  13 20:01#访问时间 bin -> usr/bin#文件名称，连接对应路径
~~~

#### 权限说明

|文件格式|说明|
|--|--|
|-|文件|
|d|目录|
|b|块设备|
|c|字符设备|
|l|连接文件|
|s|socket套接字|

权限使用9位表示，3位一组。
3主分别是：

* 所属用户 u
* 所属用户组 g
* 其他用户 o
* 另外还有全部 a

三位代表3个权限

* 读 r
* 写 w
* 执行 x

数字表示就是将3组用二进制计算值

对于文件来说：

* r 可以使用文件查看工具查看
* w 可以修改无不的内容
* x 可以直接执行

对目录来说

* r 可以使用ls等目录查看命令查看
* w 可以创建文件，也可以删除
* x 可以cd 进入目录

修改权限

~~~shell

chmod u+x 文件 #增加用户运行权限
chmod u-x 文件 #删除用户运行权限
chmod u=r 文件 #给用户赋值运行权限，其他群像删除
chmod 权限数字 文件

chattr +i 文件 #特殊权限不可以删除、修改、变更
lsattr 文件 #查看属性
chattr +a #只能最追加数据
~~~

查看文件状态

~~~shell
observation@observation-VirtualBox:/etc/ssh$ stat ssh_config
  文件：ssh_config
  大小：1603         块：8          IO 块：4096   普通文件
设备：805h/2053d   Inode：1968290     硬链接：1
权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)
最近访问：2020-05-29 15:37:09.000000000 +0800
最近更改：2020-05-29 15:37:09.000000000 +0800
最近改动：2020-09-13 20:01:20.719967589 +0800
创建时间：-

atime 访问时间  查看文件内容就会改变
mtime 修改时间  改变内容发生变化
ctime 改动时间  元数据发生变化
~~~

#### 文件通配符

* `*`所有
* `?`匹配任一单个字符
* `~`用户家目录
* [123456]其中一个
* [^123456]取反
* [0-9]数字
* [a-z]小写字母(缺少Z)
* [A-Z]大写字母(缺少a)
* [:lower:]小写字母
* [:upper:]大写字母
* [:alpha:]大写+小写字母
* [:alnum:]字母+数字
* [:digit:]数字

#### 文件操作

|命令|说明|
|--|--|
|touch 文件名|创建空文件(如果存在同文件，则刷新时间)-a 只修改atime和ctime -m 只修改mtime和ctime|
|mkdir 路径名|创建目录 -p 递归创建 -v 显示详细过程|
|rmdir 路径名|删除空目录 -p递归删除 -v显示过程|
|rm 文件名|删除文件 -r 递归 -f 强制 -i 提示|
|cp 原文件 路径|复制 -i 显示提示 -n 不覆盖 -r 递归复制 -d 只复制连接文件，不复制源文件 -a 归档 -v 显示过程 -b 备份原来的文件文件 -p 保留原来的属性|
|mv 原文件 新文件名/路径|移动或者重命名 -i 显示提示 -f 强制 -b 备份 |
|file 文件| 查看文件类型|
|dd if=输出文件 of=出入文件 bs=读取大小 count=次数 |读取一个文件输入到另外一个文件中|

##### 复制说明

1. 源文件是文件：
   * 目标是文件：
     * 如果目标不存在，则新建目标文件，并把内容复制过去
     * 如果目标存在，本命令是直接覆盖，所以带上-i参数来提示用户
   * 目标是文件夹：
     * 在文件夹中创建同名文件，并复制内容
2. 源文件是多个文件：
   * 目标必须是一个文件夹，而且必须存在，不然会报错
3. 源文件是文件夹：
   * 目标文件必须是文件夹并且带上参数-r

### 连接

~~~shell

ln 源文件 目标文件 #创建硬连接
ln -s 源文件 目标文件 #创建乱连接
~~~

1. 软连接：
   * 相当于windows的快捷方式
   * 可以对目录做软连接
   * 软连接的大小是源文件的路径字符长度
   * 软连接不会修改i磁盘应用次数
   * 可以跨分区
   * 源文件发生改变，软连接文件也跟着改变
   * 源文件删除，软连接不可访问，但是重新创建与源文件同名文件还是可以访问
2. 硬连接
   * 会改变磁盘引用数的变化
   * 指向硬盘的同一区域
   * 不可以对目录硬连接
   * 不可以跨分区
   * 源文件发生改变，硬连接文件也方式改变
   * 删除源文件，硬连接还可以继续访问

## 输出输入

* 标准输入：默认输入是来自键盘 stdin 0
* 标准输出：默认输出到终端窗口 stdout 1
* 标准错误输出：默认输出到终端窗口 stderr 2

### I/O重定向

覆盖 >

* 将标准输出重定向到文件中 命令 > 文件
* 将错误输出重定向到文件中 命令 2> 文件
* 将所有输出重定向到文件中 命令 &> 文件
* 禁止覆盖 set -C
* 允许覆盖 set +C
  
追加 >>

* 将标准输出重定向到文件中 命令 >> 文件
* 将错误输出重定向到文件中 命令 2>> 文件
* 将所有输出重定向到文件中 命令 &>> 文件

标准输出与错误输出分开保存:

* 命令 >> log.log 2>> err.log

合并所有输出：

* 命令 >> 文件 2>&1

所有内容都可以丢到/dev/null文件中

#### 多行内容输入文件

~~~shell

cat > 文件 #要使用crrl+c结束
cat > 文件 << EOF #结束单行输入EOF，EOF只是标记也可使用其他字符
~~~

### 替换

~~~shell

tr 源字符 替换字符 < 文件 #替换字符串
tr -t 源字符 替换字符  #以替换字符为标准进行一对一替换
tr -d 源字符 #删除源字符
tr -s 源字符 #对源字符进行去重
tr -sc 源字符 #对除源字符外的字符去重
tr 源字符 替换字符 < 文件A > 文件B #将a文件中内容进行替换输出到文件b中，本公约替换回源文件
~~~

### 显示

1. cat 显示文本
   * -E 显示结尾换行符
   * -n 显示每行编号
   * -b 只对非空行进行编号
   * -s 对连续空行进行压缩
2. tac 倒序显示
3. less 分屏显示
   * 向下一行 `回车`
   * 向下一页 `空格`
   * 退出 `q`
   * 搜索 `/文本`
     * 向下查找 `n`
     * 向上查找 `N`
   * man命令默认打开方式
4. more 分页显示文本
   * 默认显示读取的百分比
   * 读取完成自动退出
   * 退出 `q`
   * 显示翻页与退出提示 `d`
5. head 显示文件的前面内容  
   * 默认显示文本前10行
   * 显示前#行 -n # 或 -#
   * 显示前#字符 -c #
6. tail 显示文件的后面内容
   * 默认显示文本后10行
   * 显示后#行 -n # 或 -#
   * 显示后#字符 -c # (换行符也是一个字符)
7. cut 切割
   * cut 文件
   * 按照字符切割 -c#-#
   * 按指定符号切割，默认是`TAB` -d#
   * 显示切割后的第#个字段 -f#,#,#,#-#
8. paste 合并
   * paste 文件1 文件2
   * 按行合并，默认以`TAB`合并，也可以指定合并符 -d#
   * 原本行按列显示 -s

### 分析

1. wc 对文本进行统计
   * wc 文件
   * 行数 单词数 字节数 文件名
   * 只显示行 -l
   * 只显示单词数 -w
   * 只显示字节数 -c
   * 只显示字符数 -m
   * 最长的行的长度 -L
2. sort 排序
   * sort 文件
   * 默认从前往后按行排序
   * 倒序 -r
   * 随机排序 -R
   * 按数字排序 -n
   * 忽略大小写 -f
   * 指定分隔符 -t
   * 按指定字段排序 -k
3. uniq 合并相同的行
   * uniq 文件1
   * 相邻的完全一样内容就是相同行
   * 显示相同行出现的次数 -c
   * 只显示重复的行 -d
   * 显示从没有重复的行 -u
4. diff 对比文件
   * diff 文件1 文件2

### vim

vim [option] file

1. 模式
   * 命令模式：可以移动光标，粘贴、复制文本，进入文件后默认的模式
   * 插入模式或者编辑模式：可以修改文本
   * 末行模式或扩展命令模式：保存、退出等
   * 可以使用esc退出当前模式
![模式示意图](/pocket/img/12.png "模式示意图")
2. 模式切换
   * 命令模式-->插入模式
      * 在光标所在处切换模式 i
      * 在光标所在的行的行首切换模式 I
      * 在光标所在处后切换模式 a
      * 在光标所在的行的行尾切换模式 A
      * 在光标所在行下新开一行切换模式 o
      * 在光标所在行上新开一行切换模式 O
   * 插入模式-->命令模式
      * esc
   * 命令模式-->末行模式
      * `:`
   * 末行模式-->命令模式
      * `esc` `esc`
      * `esc` `enter`
3. 打开文件
   * 文件 #打开文件并直接定位到#行 +#
   * 打开文件，并直接定位到第一个匹配到关键字的地方 +/关键字
   * 以二进制打开文件 -b
   * 对比/同时打开多个文件 -d 文件1 文件2
   * 以只读方式打开文件 -m
   * 直接以末行模式打开 -e
4. 关闭文件
   * 末行模式
      * 保存 :w
      * 退出 :q
      * 保存并退出 :wq
      * 强制保存并退出 :wq!
      * 保存并退出 :x
   * 命令模式
      * 保存退出 ZZ
      * 不保存退出 ZQ
5. 末行模式
   * 读入文件 r 文件
   * 另存为 w 新文件
   * 直接执行shell命令 !命令
   * 直接把命令的结果写入文件 r!命令
6. 命令模式跳转
   * 字符之间跳转
      * 向右 l
      * 向左 h
      * 向下 j
      * 向上 k
      * 向后#个字符 #空格
   * 单词间跳转
      * 下一个单词词首 w
      * 当前单词的词尾或下一个单词词尾 e
      * 当前单词的词首或上一个单词的词首 b
      * 向下跳转#个单词 #w
   * 行间跳转
      * 跳转到#行 :#
      * 跳转到#行 #G
      * 直接跳转到最后一行 G
      * 跳转到第一行 gg
      * 跳转到第一行 1G
   * 段落间跳转(空行间隔为分段)
      * 上一段 {
      * 下一段 }
   * 翻屏
      * 向下翻一屏 ctrl+f
      * 向上翻一屏 ctrl+b
      * 向下翻半屏 ctrl+d
      * 向上翻半屏 ctrl+u
7. 命令模式编辑
   * 字符编辑
      * 删除光标所在的字符 x
      * 删除#个字符 #x
      * 将光标处的字符和后面的字符互换位置 xp
      * 将光标位置字符大小写互换 ～
      * 删除当前行的换行符号 J
   * 替换
      * 替换当前光标所在处的字符(替换一个字符) r
      * 进入替换模式 R
   * 删除
      * 删除,与光标跳转结合 d
      * 删除到行尾，并删除光标位置的字符 d$
      * 删除到行首，并不删除光标位置的字符 d0
      * 删除到行首非空字符 d^
      * 删除当前光标到下一个空格包括空格 dw
      * 删除当前光标到下一个空格，不包括空格 de
      * 删除当前光标到上一个空格，不包括空格 db
      * 删除整行 dd
      * 删除#行 #dd
      * 删除到结尾 dG
      * 删除到开头 dgg
      * D 相当与 d$
   * 复制
      * 复制，与光标跳转结合 y
      * 复制整行 yy
      * 复制到结尾 yG
      * 复制到开头 ygg
      * Y相当与yy
   * 粘贴
      * 如果是整行，则粘贴到当前光标所在的下一行，否则粘贴到光标后 p
      * 果是整行，则粘贴到当前光标所在的上一行，否则粘贴到光标前 P
      * 粘贴多次 #[i|I|a|A|o|O]字符串+`esc`
   * 搜索
      * 从当前光标往下搜索 /关键字
      * 从当前光标向上搜索 ？关键字
      * 相同命名的相同方向 n
      * 相同命令的相反方向 N
   * 撤销
      * 撤销最近的修改 u
      * 撤销最近的第#次修改 #u
      * 重复之前的操作 ctrl+r
      * 重复之前的操作 `.`
      * 重复#次之前的操作 `#.`
8. 命令扩展模式
   * 地址定界(对后面命令确认范围)
      * :开始,结束
      * 第#行到#+n行 ：#,+n
      * 最后一行 $
      * 到数#行 $-#
      * 全文 %
      * 关键字匹配 ：/关键字1/，/关键字2/
      * 后面可以接命令
        * 删除 d
        * 复制 y
        * 另存为文件 w 文件名
        * 读取其他文件内容写道匹配的下一行 r 文件
   * 查找并替换
      * 使用地址界定来进行查找
      * ：%s/关键字/要替换字符/装饰器
      * 关键字可以使用正则
      * 替换内容中可以使用`&`来代表匹配内容
      * 装饰器
        * 忽略大小写 i
        * 替换全部 g
        * 每次替换进行询问 gc
      * 分隔符
        * /
        * @
        * \#
9. 可视化
   * 面向字符 v
   * 面向行 V
   * 面向快 ctrl+v
   * 可以结合跳转使用
   * 对突出部分可以使用删除、复制、过滤、替换、另存为等操作
10. 多文件操作
    * 打开多个文件 vim 文件1 文件2
    * 下一个文件 ：next
    * 上一个文件 ：prev
    * 第一个文件 ：first
    * 最后一个文件 ：last
    * 全部退出 ：qall
    * 保存全部 ：wall
    * 保存并退出全部 ：wqall
    * 保存并退出全部 ：xall
    * 水平分割同时显示多个文件 -o
    * 垂直分割同时显示多个文件 -O
      * 在同时显示的窗口中切换光标 ctrl+w 上|下|左|右
    * 添加新同屏窗口
      * 水平添加 strl+w s
      * 垂直添加 strl+w v
      * 取消邻近窗口 strl+w q
      * 取消全部窗口 strl+w o
11. 工作特性
    * 全局有效 /etc/vimrc
    * 对当前用户有效 ～/.vimrc
    * 设置行号 set nu 取消 set nonu
    * 搜索忽略大小写 set ic 取消 set noic
    * 自动缩进 set ai 取消 set noai
    * 设置搜索匹配内容高亮显示 set his 取消 set nohis
    * 设置语法高亮 syntax on 取消 syntax off
    * 文件格式
      * windows格式 set fileformat=dos
      * unix格式 set fileformat=unix
    * 添加标识线 set cul 取消 set nocul
    * 获取帮助 set all
    * 获取帮助 ：help|：help|vimtutor

### 